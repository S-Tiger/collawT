<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="voteResult">
	<resultMap id="voteResult01" type="VoteVO">
		<!-- property는 화면단에서 쓸 이름, column은 데이터컬럼명이랑 동일 -->
		<result property="c_Id" column="c_Id" />
		<result property="v_Num" column="v_Num" />
		<result property="v_Content" column="v_Content" jdbcType="CLOB" javaType="java.lang.String"/>
		<result property="v_Start" column="v_Start" />
		<result property="v_End" column="v_End" />
		<result property="mem_Id" column="mem_Id" />
		<result property="v_Date" column="v_Date" />		
		<result property="v_Name" column="v_Name" />
		<result property="vs_Num" column="vs_Num" />
		<result property="v_Subject" column="v_Subject" />
		<result property="v_Count" column="v_Count" />
	</resultMap>
	
	<resultMap id="voteResult02" type="java.util.HashMap">
		<!-- property는 화면단에서 쓸 이름, column은 데이터컬럼명이랑 동일 -->
		<result property="c_Id" column="c_Id" />
		<result property="v_Num" column="v_Num" />
		<result property="v_Content" column="v_Content" jdbcType="CLOB" javaType="java.lang.String"/>
		<result property="v_Start" column="v_Start" />
		<result property="v_End" column="v_End" />
		<result property="mem_Id" column="mem_Id" />
		<result property="v_Date" column="v_Date" />		
		<result property="v_Name" column="v_Name" />
		<result property="vs_Num" column="vs_Num" />
		<result property="vs_Name" column="vs_Name" />
		<result property="v_Subject" column="v_Subject" />
		<result property="v_Count" column="v_Count" />
	</resultMap>
	
	

	<!-- 글 목록 페이징-->
 		<select id="searchList" resultMap="voteResult02" parameterType="project.jeongha.vote.vo.Criteria"> 
      <![CDATA[
		select v_Num, c_Id, v_Name, v_Content, v_Date, mem_Id, mem_name, v_Start, v_End, vs_Num, vs_Name
        from (
            select V.v_Num, V.c_Id, V.v_Name, V.v_Content, V.v_Date, V.mem_Id, V.v_Start, V.v_End, V.vs_Num, VS.vs_Name,
            M.mem_name, row_number() over(order by V.v_Num desc) as rnum
            from vote V, member M, vote_status VS
            where V.mem_Id = M.mem_Id
            and V.vs_Num = VS.vs_Num
            and V.c_Id=#{c_Id}
            )
        where rnum between #{rowStart} and #{rowEnd}
        order by to_number(v_Num) desc
      ]]>

	</select>
	
	<!-- 게시물 총 갯수 -->
	<select id="listCount" resultType="int" parameterType="project.jeongha.vote.vo.Criteria"> 
      <![CDATA[
        select count(v_Num)
        from vote
        where v_Num>0
        and c_Id=#{c_Id}
      ]]>

	</select>
	



	<!-- 글 입력 -->
	<insert id="voteInsert" parameterType="java.util.HashMap">
		<selectKey resultType="string" keyProperty="v_Num" order="BEFORE">
        SELECT vote_seq.nextval as vote_seq FROM dual        
    	</selectKey>   
		insert into vote(v_Num, c_Id, v_Name, v_Content, v_Date, mem_Id, v_Start, v_End, vs_Num, v_Subject, v_Count)
		values(#{v_Num}, #{c_Id}, #{v_Name}, #{v_Content} ,  
		(select to_char(sysdate, 'YYYY/MM/DD/ HH24:MI:SS') from dual)
		 , #{mem_Id}, #{v_Start}, #{v_End}, #{vs_Num},#{v_Subject}, #{v_Count} )
	</insert>
	
	
	<insert id="votedInsert" parameterType="java.util.Map">
	insert into voted(v_num, vd_num, vd_content, c_id)
		values( #{v_Num}, #{vd_Num}, #{vd_Content}, #{c_Id}) 
	</insert>
	
	


	<!-- 게시글 조회 -->
	<select id="voteRead"  parameterType="String" resultMap="voteResult02"> 
      <![CDATA[
        select V.v_Num, V.c_Id, V.v_Name, V.v_Content, V.v_Date, V.mem_Id, V.v_Start, V.v_End, V.v_Subject, v.vs_num, v.v_count
		from vote V
		where V.v_Num=#{v_Num}
      ]]>
	</select>
<!-- where and V.v_Num=#{v_Num} -->
	<!-- 게시물 삭제 -->
	<delete id="issueDelete" parameterType="String">
		DELETE
		FROM issue
		WHERE i_Num=#{i_Num}
	</delete>

	<!-- 게시물 수정 -->
	<update id="issueUpdate"
		parameterType="java.util.HashMap">
		UPDATE issue
		SET i_Name = #{i_Name},
		i_Content = #{i_Content},
		i_Date = (select to_char(sysdate, 'YYYY/MM/DD/ HH24:MI:SS') from dual),
		i_Start = #{i_Start},
		i_End = #{i_End},
		ig_Num = #{ig_Num}
		WHERE i_Num=#{i_Num}
	</update>
	
	
			<!-- 협업공간 조회 -->
 	<select id="igRead"  resultType="java.util.HashMap"> 
      <![CDATA[
			select *
			from issue_group
			order by ig_Num asc
      ]]>
	</select> 
	
	
	<!-- 협업공간 내 멤버 조회 -->
	 <select id="comemRead"  resultType="java.util.HashMap"> 
      <![CDATA[
			select m.mem_name, m.mem_id
			from member m, co_member co
			where m.mem_id = co.mem_id
			and c_id = #{c_id}
      ]]>
	</select> 
	
	<!-- 이슈 담당자 삽입 -->
	<insert id="comemInsert" parameterType="java.util.Map">
		insert into charger(cr_Num, i_Num, c_Id, cr_Status, mem_Id) 
		values(CR_NUM_SEQ.nextval, #{i_Num}, #{c_Id}, #{cr_Status}, #{mem_Id})
	</insert>	
	
	
	<!-- 이슈 담당자 조회 -->
	<select id="chargerRead"  resultType="java.util.HashMap"> 
      <![CDATA[
			select m.mem_id, m.mem_name
			from charger ch, member m
			where m.mem_id=ch.mem_id
			and i_Num=#{i_Num}
      ]]>
	</select> 
	
	<!-- 이슈 담당자 수정(삭제 후 다시 삽입) -->
	<delete id="chargerDelete" parameterType="String">
		DELETE
		FROM charger
		WHERE i_Num=#{i_Num}
	</delete>
	
	
		<!-- 협업공간 조회 -->
<!-- 	<select id="coRead"  resultType="java.util.HashMap"> 
      <![CDATA[
			select c.c_name,c.c_id
			from co_work c, member m
			where c.mem_id=m.mem_id
			and m.mem_id=#{mem_id}
			order by c_id asc
      ]]>
	</select> -->

 	<!-- 글쓰기 화면 전환 시 글번호 먼저 가져오기 -->
<!-- 	<select id="get_i_Num" resultMap="voteResult02"> 
      <![CDATA[
		select  from dual
      ]]>

	</select> -->

</mapper>