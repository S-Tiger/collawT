<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="personal_search">

	
	<resultMap id="personal_searchResult01" type="java.util.HashMap">
		<!-- property는 화면단에서 쓸 이름, column은 데이터컬럼명이랑 동일 -->
		<result property="i_Num" column="i_Num" />
		<result property="c_Id" column="c_Id" />
		<result property="c_Name" column="c_Name" />
		<result property="i_Name" column="i_Name" />
		<result property="i_Content" column="i_Content" jdbcType="CLOB" javaType="java.lang.String"/>
		<result property="i_Date" column="i_Date" />
		<result property="i_Start" column="i_Start" />
		<result property="i_End" column="i_End" />
		<result property="mem_Id" column="mem_Id" />
		<result property="mem_Name" column="mem_Name" />
		<result property="rnum" column="rnum" />
		<result property="boardtype" column="boardtype" />
	</resultMap>
	
	<resultMap id="fileResult01" type="java.util.HashMap">
		<!-- property는 화면단에서 쓸 이름, column은 데이터컬럼명이랑 동일 -->
		<result property="a_File" column="a_File" javaType="[B" jdbcType="BLOB"/>
		<result property="a_RealName" column="a_RealName" />
		<result property="a_NameEx" column="a_NameEx" />
		<result property="a_Num" column="a_Num" />
		<result property="a_Del" column="a_Del" />
		<result property="a_Size" column="a_Size" />
		<result property="i_Num" column="i_Num"/>
		<result property="c_Id" column="c_Id" />
		<result property="i_Name" column="i_Name" />
		<result property="i_Date" column="i_Date" />
		<result property="mem_Id" column="mem_Id" />
		<result property="c_Name" column="c_Name" />
		<result property="mem_Name" column="mem_Name" />
	</resultMap>


	
	<!-- 내가 쓴 글 확인-->
	<select id="myBoardlist" resultMap="personal_searchResult01" parameterType="project.euna.personal_search.vo.Criteria"> 
	<![CDATA[
        select c_Id, c_Name, i_Name, i_Date, mem_Id, rnum, boardtype, i_Num, rnum
		from(
		    select c_Id, c_Name, i_Name, i_Date, mem_Id, row_number() over(order by i_date desc) as rnum, boardtype, i_Num
		    from v_allboard
		    where mem_Id=#{mem_Id}
		    )
		where rnum between #{rowStart} and #{rowEnd}
	
	]]>

	</select>
	
	
	
	<!-- 내가 쓴 글 게시물 총 갯수 -->
	<select id="listCount" resultType="int" parameterType="project.euna.personal_search.vo.Criteria"> 
      <![CDATA[
		select count(*)
		from v_allboard
        where mem_Id=#{mem_Id}
      ]]>

	</select>
	
	
	<!-- 게시물 삭제 -->
	<delete id="issueDelete" parameterType="String">
		DELETE
		FROM issue
		WHERE i_Num=#{i_Num}
	</delete>
	
	
	
	<!-- 파일함 전체 뷰 -->
		<select id="myFile" resultMap="fileResult01" parameterType="String"> 
      <![CDATA[
        (select a.a_File as a_File, a.a_Realname as a_Realname, a.a_NameEx as a_NameEx, a.a_Num as a_Num, a.a_Del as a_Del, a.a_Size as a_Size,
                i.i_Num as i_Num, i.c_Id as c_Id, i.I_Name as I_Name, i.I_Date as I_Date, i.mem_Id as mem_Id,
                c.c_Name as c_Name,
                m.mem_name as mem_name
         from appendix a, issue i, co_work c, member m
         where i.i_Num = a.i_Num
         and c.c_id=i.c_id
         and m.mem_id=i.mem_id
         and a.a_Del = 'N'
         and c.c_Id in
            (
            select c_id from co_member where mem_id=#{mem_Id}
            )
         )
        union all
        (select pa.p_a_File as a_File, pa.p_a_Realname as a_Realname, pa.p_a_NameEx as a_NameEx, pa.p_a_Num as a_Num, pa.p_a_Del as a_Del, pa.p_a_Size as a_Size,
                p.p_Num as i_Num, p.mem_Id as c_Id, p.p_i_Name as I_Name, p.p_i_Date as I_Date, p.mem_Id as mem_Id,
                null as c_name,
                m.mem_name as mem_name
            from personal_appendix pa, personal p, member m
            where pa.p_Num = p.p_Num
            and m.mem_id=p.mem_id
            and pa.p_a_Del = 'N'
            and m.mem_id = #{mem_Id}
        )
		
      ]]>

	</select>




</mapper>