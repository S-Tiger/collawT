<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="whole_search">

	
	<resultMap id="whole_searchResult01" type="java.util.HashMap">
		<!-- property는 화면단에서 쓸 이름, column은 데이터컬럼명이랑 동일 -->
		<result property="i_Num" column="i_Num"/>
		<result property="c_Id" column="c_Id" />
		<result property="i_Name" column="i_Name" />
		<result property="i_Date" column="i_Date" />
		<result property="ig_Num" column="ig_Num" />
		<result property="mem_Id" column="mem_Id" />
		<result property="c_Name" column="c_Name" />
		<result property="mem_Name" column="mem_Name" />
		<result property="ig_Name" column="ig_Name" />
		<result property="wr_mem_Id" column="wr_mem_Id" />
	</resultMap>
	
	<resultMap id="whole_searchResult02" type="SearchVO">
		<!-- property는 화면단에서 쓸 이름, column은 데이터컬럼명이랑 동일 -->
		<result property="searchType" column="searchType"/>
		<result property="keyword" column="keyword" />
	</resultMap>

<!-- 이슈검색 뷰 -->
<select id="searchIssue" resultMap="whole_searchResult02" parameterType="java.util.HashMap"> 
      <![CDATA[
         select i_Num, c_Id, i_Name, i_Date, ig_Num, wr_mem_Id, c_Name, mem_Name, ig_Name, row_number() over(order by i_date desc) as rnum, boardtype
          from
              (
              (select i.i_Num as i_Num, i.c_Id as c_Id, i.i_Name as i_Name, i.i_Date as i_Date, i.ig_Num as ig_Num, i.mem_Id as mem_Id,
                      c.c_Name as c_Name,
                      m.mem_Name as mem_Name,
                      ig.ig_Name as ig_Name,
                      1 as boardtype
               from issue i, co_work c, member m, issue_group ig
               where c.c_id=i.c_id
               and m.mem_id=i.mem_id
               and i.ig_num = i.ig_num
               
               and c.c_Id in
                  (
                  select c_id from co_member where mem_id=#{mem_Id}
                  )
                
               )
              union all
              (select p.p_Num as i_Num, p.mem_Id as c_Id, p.p_i_Name as p_i_Name, p.p_i_Date as i_Date, null as ig_Num, p.mem_Id as mem_Id,
                      null as c_Name,
                      m.mem_Name as mem_Name,
                      '내 공간' as ig_Name,
                      2 as boardtype
                  from personal p, member m
                  where m.mem_id=p.mem_id
              )
          )
               	]]>
           <trim prefix="WHERE" prefixOverrides="AND|OR">
				<if test="searchType=='i_Name' and keyword != null and keyword != '' ">
					AND i_Name like CONCAT('%', #{keyword}, '%')
				</if>
				<if test="searchType=='i_Content' and keyword != null and keyword != '' ">
					AND i_Content like CONCAT('%', #{keyword}, '%')
				</if>
				<if test="searchType=='mem_Id' and keyword != null and keyword != '' ">
					AND mem_Id like CONCAT('%', #{keyword}, '%')
				</if>	
				<if test="searchType=='mem_Name' and keyword != null and keyword != '' ">
					AND mem_Name like CONCAT('%', #{keyword}, '%')
				</if>
		</trim>

	</select>
	
<!-- 	              union all
              (select p.p_Num as i_Num, p.mem_Id as c_Id, p.p_i_Name as p_i_Name, p.p_i_Date as i_Date, null as ig_Num, p.mem_Id as mem_Id,
                      null as c_Name,
                      m.mem_Name as mem_Name,
                      '내 공간' as ig_Name
                  from personal p, member m
                  where m.mem_id=p.mem_id
                  and m.mem_id = #{mem_Id}
              ) -->
	

	
	




</mapper>